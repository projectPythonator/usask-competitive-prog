Translated and transfered to cpp version
